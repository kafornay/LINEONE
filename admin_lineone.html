// ... código anterior ...

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  msg.innerText = "⏳ Enviando...";
  msg.style.color = "#fff";
  idProdutoDiv.innerText = "";

  const file = imgInput.files[0];
  if (!file) {
    msg.innerText = "Selecione uma imagem!";
    return;
  }

  // Lê a imagem como base64
  const reader = new FileReader();
  reader.onload = async function(event) {
    const base64 = event.target.result.split(',')[1]; // remove o prefixo data:image/...

    const formData = new FormData();
    formData.append("action", "add");
    formData.append("nome", document.getElementById("nome").value);
    formData.append("descricao", document.getElementById("descricao").value);
    formData.append("preco", document.getElementById("preco").value);
    formData.append("estoque", document.getElementById("estoque").value);
    formData.append("imagemBase64", base64);
    formData.append("imagemTipo", file.type);

    try {
      const resposta = await fetch(SCRIPT_URL, { method: "POST", body: formData });
      const dados = await resposta.json();
      if (dados.sucesso || dados.success) {
        msg.style.color = "#4CAF50";
        msg.innerText = "✅ Produto adicionado com sucesso!";
        if(dados.id){
          idProdutoDiv.innerHTML = `ID do Produto:<br><b>${dados.id}</b>`;
        }
        form.reset();
        preview.style.display = "none";
      } else {
        msg.style.color = "red";
        msg.innerText = "❌ Erro: " + (dados.message || dados.erro || "Falha desconhecida");
      }
    } catch (erro) {
      msg.style.color = "red";
      msg.innerText = "❌ Falha ao conectar: " + erro;
    }
  };
  reader.readAsDataURL(file);
});
